{% extends 'layout.html' %}
{% block body %}

    {% if not session.logged_in == NULL %}
        <h1 class="text">add book</h1>
        <div>
            <input type="text" placeholder="book title" name="title" maxlength="120"/>
            <input type="text" placeholder="author" name="author" maxlength="120"/>
            <input type="text" placeholder="description" name="description" maxlength="120"/>
            <input type="number" placeholder="quantity" name="quantity" min="0"/>
            <button onclick="addBook()">add</button>
        </div>
    {% endif %}


    <div style="margin-top: 5em;">
        <h1 class="text">list</h1>
        <table class="text">
            <thead>
                <tr>
                    <th>id</th>
                    <th>title</th>
                    <th>author</th>
                    <th>description</th>
                    <th>quantity</th>
                    <th>owner</th>
                </tr>
            </thead>

            <tbody>
                {% for book in books %}
                    <tr>
                        <td data-label="id">{{book.id}}</td>
                        <td data-label="title">{{book.title}}</td>
                        <td data-label="author">
                            {% if book.author %}
                                {{book.author}}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td data-label="description">
                            {% if book.description %}
                                {{book.description}}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td data-label="quantity">{{book.quantity}}</td>
                        <td data-label="owner">{{book.owner.username}}</td>
                        {% if not session.logged_in == NULL %}
                            <td data-label="-^-">
                                {% if book.owner.username == session.username %}

                                    {% set call = "deleteBook("~book.id~")" %}
                                    <button onclick={{call}}>X</button>

                                {% else %}

                                    {% set call = "borrowBook("~book.id~")" %}
                                    <button onclick={{call}}>B</button>

                                {% endif %}
                            </td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if session.logged_in != NULL and trackers.count() > 0 %}
    <div style="margin-top: 5em;">
        <h1 class="text">borrowed books</h1>
        <table class="text">
            <thead>
                <tr>
                    <th>id</th>
                    <th>book_id</th>
                    <th>title</th>
                    <th>borrowed_at</th>
                    <th>returned_at</th>
                    <th>owner</th>
                </tr>
            </thead>
            <tbody>
                {% for tracker in trackers %}
                <tr>
                    <td data-label="id">{{tracker.id}}</td>
                    <td data-label="book_id">{{tracker.book.id}}</td>
                    <td data-label="title">{{tracker.book.title}}</td>
                    <td data-label="borrowed_at">{{tracker.borrowed_at}}</td>
                    <td data-label="returned_at">
                        {% if tracker.returned_at %}
                            {{tracker.returned_at}}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td data-label="owner">{{tracker.book.owner.username}}</td>
                    {% if not tracker.returned_at %}
                        <td data-label="-^-">
                            
                            {% set params = [
                                    tracker.book.id,
                                    "'"+tracker.book.title+"'",
                                    "'"+tracker.book.author+"'"
                                ]|join(',') %}
                            {% set call = "returnBook("+params+")" %}
                            <button onclick={{call}}>R</button>
                        </td>
                    {% endif %}
                    </tr>
                    {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
{% endblock %}